<script>
registerModule({
  id:'vent',
  title:'Vent',
  mount(root){
    const condSel = el('select',{}, el('option',{value:'ARDS'},'ARDS'), el('option',{value:'COPD'},'COPD'));
    const pbw = el('input',{type:'number', value:'70'});
    const out = el('div',{class:'small'});
    const ui = el('div',{class:'card'},
      el('div',{class:'input'}, el('label',{},'Condition'), condSel),
      el('div',{class:'input'}, el('label',{},'PBW (kg)'), pbw),
      el('button',{class:'btn', onclick:()=>{
        google.script.run.withSuccessHandler(res=>{
          out.innerHTML = '<b>'+res.condition+'</b><br>VT: '+res.vt_recommended+' ('+res.vt_mlkg+' mL/kg PBW)' +
                          '<br>PEEP start: '+res.peep_start+'; FiO2 start: '+res.fio2_start+
                          '<br><span class=small>Refs: '+(res.refs||'')+'</span>';
        }).api_vent_suggest({condition:condSel.value, pbwKg:Number(pbw.value)});
      }}, 'Suggest'),
      out
    );
    root.append(ui);
  }
});
</script>
